<div class="uk-container">

    <div class="uk-grid" uk-grid>
        {% if user.city is null %}
            <div class="uk-width-1-1">
                <div class="uk-alert-warning" uk-alert>
                    <h3>Warning: Incomplete Profile</h3>
                    <p>Your profile is incomplete. Please complete your profile so educators and students can find you.
                        <br/><strong><a href="{{ path('profile_edit', {'id': user.id}) }}">Click here to
                                begin.</a></strong></p>
                </div>
            </div>
        {% endif %}
        <div class="uk-width-2-3@m uk-width-1-1">


            <!-- CALL TO ACTIONS -->
            <div class="profile-card-wrapper">
                <div class="uk-card uk-card-default">
                    <div class="uk-card-header" style="padding: 50px">
                        <div class="uk-grid-small uk-flex-middle" uk-grid>
                            <div class="uk-width-expand">
                                <h2>Empower students and share your expertise</h2>
                            </div>
                        </div>
                    </div>
                    <div class="uk-card-body">

                        {% if user.company is not null %}
                            <div class="uk-grid">
                                <div class="uk-width-auto">
                                    <img src="{{ asset('build/images/calendar.svg') }}">
                                </div>
                                <div class="uk-width-expand">
                                    <h4>Host a Student Experience</h4>
                                    <p>Develop student interest and educator knowledge in your industry through company visits, internships, job shadows and informational interviews.</p>
                                    <a href="{{ path('company_experience_create', {id: user.company.id}) }}" class="uk-button uk-button-primary" style="width: 300px">GET STARTED</a>
                                </div>
                            </div>
                        {% endif %}

                        <div class="uk-grid">
                            <div class="uk-width-auto">
                                <img src="{{ asset('build/images/lecture.svg') }}">
                            </div>
                            <div class="uk-width-expand">
                                <h4>Share your expertise with students</h4>
                                <p>Become a guest topic instructor in your area of expertise. Help students see the applicability of their schooling to the workplace and spark interest amongst students in your career field.</p>
                                <a href="{{ path('lesson_index') }}" class="uk-button uk-button-primary" style="width: 300px">BROWSE LESSON TOPICS</a>
                            </div>
                        </div>

                        <div class="uk-grid">
                            <div class="uk-width-auto">
                                <img src="{{ asset('build/images/mentor.svg') }}">
                            </div>
                            <div class="uk-width-expand">
                                <h4>Connect with educators to see if you can help support their students</h4>
                                <p>Serve your community by connecting with educators in your field. Start a conversation and see what they might want help with, from mentoring to teaching a guest lesson topic.</p>
                                <a href="{{ path('educator_results_page') }}" class="uk-button uk-button-primary" style="width: 300px">BROWSE EDUCATORS</a>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <br>
            <br>
            <!-- END CALL TO ACTIONS -->

            <!-- START PROFILE -->
            <div class="profile-card-wrapper">
                <div class="uk-card uk-card-default">
                    <div class="uk-card-header">
                        <div class="uk-grid-small uk-flex-middle" uk-grid>
                            <div class="uk-width-auto">
                                <img class="uk-border-circle" width="40" height="40"
                                     src="{{ ( attribute(user, 'photo') is defined and user.photo ) ? asset(uploaded_asset(user.photoPath))|imagine_filter('squared_thumbnail_small') : asset('build/images/avatar.png') }}">
                            </div>
                            <div class="uk-width-expand">
                                <a href="{{ path('profile_index', {'id': user.id}) }}">
                                    <h3 class="uk-card-title uk-margin-remove-bottom">{{ user.getFullName }}</h3>
                                </a>
                                <p class="uk-text-meta uk-margin-remove-top">
                                    {% if user.company is defined and user.company is not null %}
                                        <span><a href="{{ path('company_view', {'id': user.company.id}) }}">{{ user.company.name }}</a></span>
                                    {% else %}
                                        <span>Professional</span>
                                    {% endif %}

                                    {% if user.primaryIndustry is defined %}
                                        <span>- {{ user.primaryIndustry.name }}</span>
                                    {% endif %}
                                    {% if user.secondaryIndustries|length > 0 %}
                                        <span>- {{ user.secondaryIndustries[0].name }}</span>
                                    {% endif %}
                                </p>
                            </div>
                            <div class="uk-width-auto">
                                <div class="uk-align-right">
                                    <a href="{{ path('profile_index', {'id': user.id}) }}">My Public Profile</a>
                                    <a href="{{ path('profile_edit', {'id': user.id}) }}"><span
                                                class="uk-margin-small-right"
                                                uk-icon="icon: file-edit; ratio: 1"></span></a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="uk-card-body">
                        {% if user.briefBio %}
                            <div class="uk-margin">
                                {{ user.briefBio|raw }}
                            </div>
                        {% else %}
                            <p>Welcome to {{ get_site().name }}! <a href="{{ path('profile_edit', {'id': user.id}) }}">Add
                                    a brief bio</a> to let everyone know your strengths!</p>
                        {% endif %}
                        <div class="professional-links">
                            {% if user.emailAfterPrivacySettingsApplied %}
                                <a href="mailto:{{ user.emailAfterPrivacySettingsApplied }}"
                                   class="uk-icon-button uk-margin-small-right" uk-icon="mail"></a>
                            {% endif %}
                            {% if user.phoneAfterPrivacySettingsApplied and user.phoneExt %}
                                <a href="tel:{{ user.phoneAfterPrivacySettingsApplied }},{{ user.phoneExt }}"
                                   class="uk-icon-button uk-margin-small-right" uk-icon="receiver"></a>
                            {% elseif user.phoneAfterPrivacySettingsApplied %}
                                <a href="tel:{{ user.phoneAfterPrivacySettingsApplied }}"
                                   class="uk-icon-button uk-margin-small-right" uk-icon="receiver"></a>
                            {% endif %}
                            {% if user.getLinkedinProfile %}
                                <a href="{{ user.linkedinProfile }}" class="uk-icon-button uk-margin-small-right"
                                   uk-icon="linkedin" target="_blank"></a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            <!-- END PROFILE -->

            <div class="uk-margin">
                <ul class="uk-tab" id="user-nav" uk-switcher="connect: #tab-user-preferences" uk-tab>
                    <li class="uk-active"><a href="#user-lessons">My Topics</a></li>
                    <li><a href="#user-schools">My Schools</a></li>
                    <li><a href="#user-preferences">My Calendar</a></li>
                    <li><a href="#user-feedback">My Feedback</a></li>
                    <li><a href="#user-events">
                            Provide Feedback
                            {% if dashboards.eventsMissingFeedback|length > 0 %}
                                ({{ dashboards.eventsMissingFeedback|length }})
                            {% endif %}
                        </a></li>
                </ul>


                <div class="uk-switcher" id="tab-user-preferences">

                    <!-- my topics -->
                    <div class="user_preferences_lessons">
                        <div class="uk-card uk-card-default">
                            <div class="uk-card-header">
                                <div class="uk-grid-small uk-flex-middle" uk-grid>
                                    <div class="uk-width-auto">
                                        <i class="fa fa-book" aria-hidden="true"></i>
                                    </div>
                                    <div class="uk-width-expand">
                                        <h3 class="uk-card-title uk-margin-remove-bottom">Topics I Can Teach</h3>
                                    </div>
                                    <div class="uk-width-auto">
                                        <div class="uk-align-right">
                                            <a href="{{ path('lesson_index') }}">
                                                <span class="uk-margin-small-right"
                                                      uk-icon="icon: file-edit; ratio: 1"></span>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="uk-card-body">
                                {% if user.lessonTeachables|length > 0 %}
                                    <ul class="uk-list uk-list-divider">
                                        {% for teachable in user.lessonTeachables %}
                                            <li><a class="uk-link-text"
                                                   href="{{ path('lesson_view', {'id': teachable.lesson.id}) }}">{{ teachable.lesson.title }}</a>
                                            </li>
                                        {% endfor %}
                                    </ul>
                                {% else %}
                                    <p>You haven't added any topics yet.</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- my schools -->
                    <div class="user_preferences_schools">
                        <div class="uk-card uk-card-default">
                            <div class="uk-card-header">
                                <div class="uk-grid-small uk-flex-middle" uk-grid>
                                    <div class="uk-width-auto">
                                        <i class="fa fa-graduation-cap" aria-hidden="true"></i>
                                    </div>
                                    <div class="uk-width-expand">
                                        <h3 class="uk-card-title uk-margin-remove-bottom">Schools I Volunteer At</h3>
                                    </div>
                                    <div class="uk-width-auto">
                                        <div class="uk-align-right">
                                            <a href="{{ path('profile_edit', {'id': user.id}) }}#account-details-profile-schools">
                                                Manage Schools <span class="uk-margin-small-right"
                                                                     uk-icon="icon: file-edit; ratio: 1"></span>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="uk-card-body">
                                {% if user.schools is defined and user.schools|length > 0 %}
                                    <ul class="uk-list uk-list-divider">
                                        {% for school in user.schools %}
                                            <li>
                                                <a href="{{ path('school_view', { 'id': school.id }) }}">{{ school.name }}</a>
                                            </li>
                                        {% endfor %}
                                    </ul>
                                {% else %}
                                    <p>You haven't added any schools yet.</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- my calendar -->
                    <div class="user_preferences_calendar">
                        <div class="react-events-embed" data-user-id="{{ user.id }}"></div>
                    </div>

                    <!-- provide feedback -->
                    <div class="user_preferences_feedback">
                        {# FEEDBACK WIDGET #}
                        {{ feedback_widget(user)|raw }}
                    </div>

                    <!-- proivde feedback -->
                    <div class="user_preferences_events">

                        <div class="uk-margin">
                            <div class="uk-card uk-card-default">
                                <div class="uk-card-body">
                                    <h3 class="uk-card-title uk-margin-remove-bottom">My Reviews</h3>
                                    <ul class="uk-tab" uk-switcher="connect: #tab-reviews" uk-tab>
                                        <li class="uk-active"><a href="#reviews-todo">Todo</a></li>
                                        <li><a href="#reviews-submitted">Submitted</a></li>
                                    </ul>
                                    <div class="uk-switcher" id="tab-reviews">
                                        <div class="tab-reviews__todo">
                                            {% if dashboards.eventsMissingFeedback|length > 0 %}
                                                <ul class="uk-list uk-list-divider">
                                                    {% for eventProps in dashboards.eventsMissingFeedback %}
                                                        <li class="uk-position-relative"
                                                            id="feedback_{{ eventProps.event.id }}">
                                                            <span class="uk-position-center-right"><button
                                                                        class="uk-button uk-button-text delete-feedback uk-text-danger"
                                                                        data-id="{{ eventProps.event.id }}">X</button></span>
                                                            <a class="uk-link-text"
                                                               href="{{ path('experience_feedback', {'id': eventProps.event.id}) }}">{{ eventProps.event.title }}</a>
                                                        </li>
                                                    {% endfor %}
                                                </ul>
                                            {% else %}
                                                <p>All reviews are up to date!</p>
                                            {% endif %}
                                        </div>
                                        <div class="tab-reviews__submitted">
                                            {% if dashboards.eventsWithFeedback|length > 0 %}
                                                <ul class="uk-list uk-list-divider">
                                                    {% for eventProps in dashboards.eventsWithFeedback %}
                                                        <li><a class="uk-link-text"
                                                               href="{{ path('experience_feedback', {'id': eventProps.event.id}) }}">{{ eventProps.event.title }}</a>
                                                        </li>
                                                    {% endfor %}
                                                </ul>
                                            {% else %}
                                                <p>No experiences reviews have been submitted.</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <div class="uk-width-1-3@m uk-width-1-1">

            <!-- Start My Requests -->
            <div class="quick-links-wrapper uk-margin">
                <div class="uk-card uk-card-default">
                    <div class="uk-card-header">
                        <div class="uk-grid-small uk-flex-middle" uk-grid>
                            <div class="uk-width-expand">
                                <h3 class="uk-card-title uk-margin-remove-bottom">My Requests</h3>
                            </div>
                            <div class="uk-width-auto">
                                <div class="uk-align-right">
                                    <a href="{{ path('requests') }}">
                                        <i class="fa fa-paper-plane" aria-hidden="true"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="uk-card-body">
                        {{ render(controller('App\\Controller\\DashboardController::myRequests')) }}
                    </div>
                </div>
            </div>
            <!-- End My Requests -->

            <!-- Star Volunteer Roles -->
            <div class="quick-links-wrapper uk-margin">
                <div class="uk-card uk-card-default">
                    <div class="uk-card-header">
                        <div class="uk-grid-small uk-flex-middle" uk-grid>
                            <div class="uk-width-expand">
                                <h3 class="uk-card-title uk-margin-remove-bottom">My Volunteer Roles</h3>
                            </div>
                            <div class="uk-width-auto">
                                <div class="uk-align-right">
                                    <a href="{{ path('profile_edit', {'id': user.id}) }}">
                                        <span class="uk-margin-small-right" uk-icon="icon: file-edit; ratio: 1"></span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="uk-card-body">
                        {% if user.rolesWillingToFulfill|length %}
                            <ul class="uk-list uk-list-divider">
                                {% for role in user.rolesWillingToFulfill %}
                                    <li>{{ role.name }}</li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <p>You haven't added any roles yet.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            <!-- End Volunteer Roles -->


            <!-- Start My Company -->
            <div class="quick-links-wrapper uk-margin">
                <div class="uk-card uk-card-default">
                    <div class="uk-card-header">
                        <div class="uk-grid-small uk-flex-middle" uk-grid>
                            <div class="uk-width-expand">
                                <h3 class="uk-card-title uk-margin-remove-bottom">My Company</h3>
                            </div>
                            {% if user.company is defined and user.company %}
                                <div class="uk-width-auto">
                                    <div class="uk-align-right">
                                        <a href="{{ path('company_view', { id: user.company.id }) }}">
                                            <span class="uk-margin-small-right"
                                                  uk-icon="icon: file-edit; ratio: 1"></span>
                                        </a>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="uk-card-body">
                        {% if user.company is defined and user.company %}
                            <a href="{{ path('company_view', { id: user.company.id }) }}">{{ user.company.name }}</a>
                            <br>
                            <p>Owner: {{ user.company.owner ? user.company.owner.fullName : 'N/A' }}</p>
                            <p class="uk-link-muted">Employees: ({{ user.company.professionalUsers|length }})</p>
                            <p class="uk-link-muted">{{ user.company.formattedAddress }}</p>
                            <p class="uk-link-muted">{{ user.company.phone }}</p>
                            <p class="uk-link-muted">{{ user.company.emailAddress }}</p>
                        {% else %}
                            <div className="uk-placeholder uk-text-center">
                                <p>You aren't associated with a company yet.</p>
                                <a href="{{ path('company_index') }}"
                                   class="uk-button uk-button-default uk-button-small uk-inline uk-margin-small-right">Join
                                    a Company</a>
                                <a href="{{ path('company_new') }}"
                                   class="uk-button uk-button-primary uk-button-small uk-inline">Create</a>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            <!-- End My Company -->


            <!-- Start Guides and Best Practices -->
            <div class="quick-links-wrapper uk-margin">
                <div class="uk-card uk-card-default">
                    <div class="uk-card-header">
                        <div class="uk-grid-small uk-flex-middle" uk-grid>
                            <div class="uk-width-expand">
                                <h3 class="uk-card-title uk-margin-remove-bottom">Guides and Best Practices</h3>
                            </div>
                        </div>
                    </div>
                    <div class="uk-card-body">
                        {{ render(controller('App\\Controller\\DashboardController::guidesAndBestPractices')) }}
                    </div>
                </div>
            </div>
            <!-- End Guides and Best Practices -->

            <!-- Start New Topics -->
            <div class="quick-links-wrapper uk-margin">
                <div class="uk-card uk-card-default">
                    <div class="uk-card-header">
                        <div class="uk-grid-small uk-flex-middle" uk-grid>
                            <div class="uk-width-expand">
                                <h3 class="uk-card-title uk-margin-remove-bottom">New Topics</h3>
                            </div>
                            <div class="uk-width-auto">
                                <div class="uk-align-right">
                                    <a href="{{ path('lesson_new') }}">
                                            <span class="uk-margin-small-right"
                                                  uk-icon="icon: plus; ratio: 1"></span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="uk-card-body">
                        <div style="text-align: left">
                            {{ render(controller('App\\Controller\\DashboardController::topics')) }}
                        </div>
                    </div>
                </div>
            </div>
            <!-- End New Topics -->

            <!-- Start New Experiences -->
            <div class="quick-links-wrapper uk-margin">
                <div class="uk-card uk-card-default">
                    <div class="uk-card-header">
                        <div class="uk-grid-small uk-flex-middle" uk-grid>
                            <div class="uk-width-expand">
                                <h3 class="uk-card-title uk-margin-remove-bottom">New Experiences</h3>
                            </div>
                            {% if user.isAdmin or user.id == user.company.owner.id %}
                                <div class="uk-width-auto">
                                    <div class="uk-align-right">
                                        <a href="{{ path('company_experience_create', { id: user.company.id }) }}">
                                            <span class="uk-margin-small-right"
                                                  uk-icon="icon: plus; ratio: 1"></span>
                                        </a>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="uk-card-body">
                        {{ render(controller('App\\Controller\\DashboardController::experiences')) }}
                    </div>
                </div>
            </div>
            <!-- End New Experiences -->

        </div>
    </div>
</div>

<div id="delete-modal" uk-modal>
    <div class="uk-modal-dialog uk-modal-body">
        <h2 class="uk-modal-title">Delete Feedback Review Request</h2>
        <p>Are you sure you do not want to provide feedback for this experience?</p>
        <div id="delete-feedback-request-form-holder">
        </div>
        </form>
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
    $(document).ready(function () {
        var tab = GetURLParameter('tab');
        if (tab) {
            UIkit.switcher('#user-nav').show(4);
        }
    });

    function GetURLParameter(sParam) {
        var sPageURL = window.location.search.substring(1);
        var sURLVariables = sPageURL.split('&');
        for (var i = 0; i < sURLVariables.length; i++) {
            var sParameterName = sURLVariables[i].split('=');
            if (sParameterName[0] == sParam) {
                return sParameterName[1];
            }
        }
    }
</script>